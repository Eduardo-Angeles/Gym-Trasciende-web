---
import { Image } from "astro:assets";
import GalleryLightbox from "@components/media/GalleryLightbox.tsx";
import SectionContainer from "@components/layout/SectionContainer.astro";
import Subtitle from "@components/ui/Subtitle.astro";

// Interface TypeScript para las imágenes de la galería
interface GalleryImage {
  src: string;
  alt: string;
  category: string;
  size: "normal" | "tall" | "wide" | "big";
}

// CONFIGURACIÓN DE IMÁGENES
// Aquí defines todas las fotos de la galería
// Cambia las rutas y añade/elimina según necesites
const galleryImages: GalleryImage[] = [
  {
    src: "/gallery/gym-1.jpg",
    alt: "",
    category: "instalaciones",
    size: "normal" // normal (1x1), tall (1x2), wide (2x1), big (2x2)
  },
  {
    src: "/gallery/gym-2.jpg",
    alt: "",
    category: "instalaciones",
    size: "tall" // Vertical
  },
  {
    src: "/gallery/gym-3.jpg",
    alt: "",
    category: "clases",
    size: "normal"
  },
  {
    src: "/gallery/gym-4.webp",
    alt: "",
    category: "transformaciones",
    size: "wide" // Horizontal
  },
  {
    src: "/gallery/gym-5.jpg",
    alt: "",
    category: "instalaciones",
    size: "normal"
  },
  {
    src: "/gallery/gym-6.jpg",
    alt: "",
    category: "clases",
    size: "tall" // Vertical
  },
  {
    src: "/gallery/gym-7.jpg",
    alt: "",
    category: "instalaciones",
    size: "normal"
  },
  {
    src: "/gallery/gym-8.jpg",
    alt: "",
    category: "instalaciones",
    size: "normal"
  },
  {
    src: "/gallery/gym-9.jpg",
    alt: "",
    category: "clases",
    size: "wide" // Horizontal
  },
  {
    src: "/gallery/gym-10.jpg",
    alt: "",
    category: "instalaciones",
    size: "normal"
  },
  {
    src: "/gallery/gym-11.jpg",
    alt: "",
    category: "clases",
    size: "normal"
  },
  {
    src: "/gallery/gym-12.jpg",
    alt: "",
    category: "instalaciones",
    size: "normal"
  },
];

// CONFIGURACIÓN DE DISEÑO
// Ajusta estos valores para cambiar la apariencia del grid
const gridConfig: Record<string, string> = {
  cols: "grid-cols-2 md:grid-cols-4", // Columnas responsive (2 móvil, 4 desktop)
  rows: "auto-rows-[250px]", // Altura base de cada celda
  gap: "gap-4", // Espacio entre imágenes
  flow: "grid-flow-dense", // Rellena espacios automáticamente
  roundedCorners: "rounded-lg", // Esquinas redondeadas
  hoverEffect: "hover:scale-105", // Efecto al pasar el mouse
  transition: "transition-transform duration-300 ease-out"
};

// Obtener clases de tamaño según el tipo (solo aplica en desktop md+)
const getSizeClasses = (size: GalleryImage["size"]): string => {
  switch (size) {
    case "tall":
      return "md:row-span-2"; // Ocupa 2 filas (vertical)
    case "wide":
      return "md:col-span-2"; // Ocupa 2 columnas (horizontal)
    case "big":
      return "md:col-span-2 md:row-span-2"; // Ocupa 2x2 (grande)
    default:
      return ""; // Tamaño normal (1x1)
  }
};
---
<!-- Sección de Galería -->
<SectionContainer class="py-16 md:py-20">
  <div class="space-y-6 md:space-y-8">
    <Subtitle>
      Nuestra <span class="text-primary">Galería</span>
    </Subtitle>

  <section class="w-full">
  <!-- Grid de imágenes con tamaños variados (SSR, carga instantánea) -->
  <div class:list={["grid", gridConfig.cols, gridConfig.rows, gridConfig.flow, gridConfig.gap]}>
    {galleryImages.map((image, index) => (
      <button
        type="button"
        class:list={[
          "relative overflow-hidden cursor-pointer",
          "focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 focus:ring-offset-black",
          getSizeClasses(image.size),
          gridConfig.roundedCorners,
          gridConfig.transition,
          gridConfig.hoverEffect,
        ]}
        data-gallery-trigger
        data-image-index={index}
        aria-label={`Abrir imagen: ${image.alt}`}
      >
        <!-- Imagen optimizada con Astro -->
        <Image
          src={image.src}
          alt={image.alt}
          width={600}
          height={600}
          quality={80}
          loading={index < 4 ? "eager" : "lazy"}
          class="w-full h-full object-cover"
        />
        
        <!-- Overlay sutil al hover -->
        <div class="absolute inset-0 bg-black/0 hover:bg-black/20 transition-colors duration-300" aria-hidden="true" />
      </button>
    ))}
  </div>

  <!-- Lightbox interactivo (Preact, carga solo cuando se necesita) -->
  <GalleryLightbox 
    client:idle
    images={galleryImages}
  />
  </section>
  </div>
</SectionContainer>

<!-- 
  NOTAS PARA MODIFICAR:
  
  1. AÑADIR IMÁGENES: 
     - Sube tus fotos a /public/gallery/
     - Añade objetos al array galleryImages con src, alt y category
  
  2. CAMBIAR DISEÑO DEL GRID:
     - Modifica gridConfig.cols para cambiar columnas (ej: "grid-cols-1 sm:grid-cols-2 lg:grid-cols-3")
     - Modifica gridConfig.aspectRatio para cambiar proporción (aspect-video, aspect-4/3, etc.)
     - Modifica gridConfig.gap para cambiar espaciado (gap-2, gap-6, gap-8, etc.)
  
  3. ELIMINAR EFECTO HOVER:
     - Cambia gridConfig.hoverEffect a ""
  
  4. AÑADIR FILTROS POR CATEGORÍA:
     - Las categorías ya están listas en los datos
     - Puedes agregar botones de filtro antes del grid
  
  5. OPTIMIZACIÓN DE CARGA:
     - loading="eager" en las primeras 4 imágenes (above the fold)
     - loading="lazy" en el resto
     - Ajusta width/height según el tamaño real que necesites
-->
