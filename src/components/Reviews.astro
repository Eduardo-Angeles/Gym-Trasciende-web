---
import Subtitle from "./Subtitle.astro";
import SectionContainer from "./SectionContainer.astro";

interface Review {
  name: string;
  image: string;
  starColor: string;
  nameColor: string;
  testimonial: string;
}

const reviews: Review[] = [
  {
    name: "María González",
    image: "/review1.webp",
    starColor: "text-emerald-400",
    nameColor: "text-emerald-400",
    testimonial:
      "¡Los entrenadores están súper capacitados y las instalaciones son de primera. Llevo 6 meses entrenando y los resultados son evidentes. Totalmente recomendado para quien busca un gimnasio serio.",
  },
  {
    name: "Carlos Rodríguez",
    image: "/review2.webp",
    starColor: "text-emerald-400",
    nameColor: "text-emerald-400",
    testimonial:
      "Llevo 8 meses y es el mejor gimnasio donde he estado. Las clases de spinning son mi favoritas y el área de pesas tiene todo lo que necesitas. Los instructores siempre están atentos a corregir tu postura.",
  },
  {
    name: "Laura Fernández",
    image: "/review3.webp",
    starColor: "text-emerald-400",
    nameColor: "text-emerald-400",
    testimonial:
      "Me encanta entrenar en Gym Trasciende. El ambiente es motivador, las máquinas están siempre en perfecto estado y los horarios son súper flexibles. He logrado mis objetivos gracias al apoyo de los entrenadores.",
  },
  {
    name: "Ana Patricia Morales",
    image: "/review4.webp",
    starColor: "text-emerald-400",
    nameColor: "text-emerald-400",
    testimonial:
      "Descubrí Gym Trasciende por recomendación y ahora no puedo parar de entrenar aquí. Las instalaciones son limpias, modernas y el personal es muy amable. He mejorado mi condición física y mi salud. Muy recomendado.",
  },
];

const starPath =
  "M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z";
---

<link
  href="https://cdn.jsdelivr.net/npm/keen-slider@6.8.6/keen-slider.min.css"
  rel="stylesheet"
/>

<style>
  /* Permitir que las imágenes de perfil sobresalgan de las tarjetas */
  #keen-slider.keen-slider {
    overflow: visible !important;
  }
  #keen-slider .keen-slider__slide {
    overflow: visible !important;
  }
</style>

<script type="module" is:inline data-astro-rerun>
  import KeenSlider from "https://cdn.jsdelivr.net/npm/keen-slider@6.8.6/+esm";

  function setupKeenSlider() {
    const keenSliderActive = document.getElementById("keen-slider-active");
    const keenSliderCount = document.getElementById("keen-slider-count");

    const keenSlider = new KeenSlider(
      "#keen-slider",
      {
        loop: true,
        defaultAnimation: {
          duration: 750,
        },
        slides: {
          origin: "center",
          perView: 1,
          spacing: 16,
        },
        breakpoints: {
          "(min-width: 640px)": {
            slides: {
              origin: "center",
              perView: 1.5,
              spacing: 16,
            },
          },
          "(min-width: 768px)": {
            slides: {
              origin: "center",
              perView: 1.75,
              spacing: 16,
            },
          },
          "(min-width: 1024px)": {
            slides: {
              origin: "center",
              perView: 3,
              spacing: 16,
            },
          },
        },
        created(slider) {
          slider.slides[slider.track.details.rel].classList.remove(
            "opacity-40",
          );

          keenSliderActive.innerText = slider.track.details.rel + 1;
          keenSliderCount.innerText = slider.slides.length;
        },
        slideChanged(slider) {
          slider.slides.forEach((slide) => slide.classList.add("opacity-40"));

          slider.slides[slider.track.details.rel].classList.remove(
            "opacity-40",
          );

          keenSliderActive.innerText = slider.track.details.rel + 1;
        },
      },
      [],
    );

    const keenSliderPrevious = document.getElementById("keen-slider-previous");
    const keenSliderNext = document.getElementById("keen-slider-next");

    keenSliderPrevious.addEventListener("click", () => keenSlider.prev());
    keenSliderNext.addEventListener("click", () => keenSlider.next());
  }

  document.addEventListener("astro:page-load", setupKeenSlider);
  document.addEventListener("astro:after-swap", setupKeenSlider);
  setupKeenSlider();
</script>

<SectionContainer class="py-12 lg:py-16">
  <Subtitle>¿Qué Dicen de Nosotros?</Subtitle>
  <div class="mt-8 pt-14 sm:pt-16">
    <div id="keen-slider" class="keen-slider overflow-visible">
      {
        reviews.map((review) => (
          <div class="keen-slider__slide overflow-visible opacity-40 transition-opacity duration-500">
            <blockquote class="relative rounded-lg bg-gray-900/80 p-6 pt-16 shadow-sm backdrop-blur-md sm:p-8 sm:pt-20">
              <img
                alt=""
                src={review.image}
                class="absolute top-0 left-1/2 size-24 -translate-x-1/2 -translate-y-1/2 rounded-full border-4 border-gray-900/80 object-cover shadow-lg sm:size-28"
              />

              <div class="text-center">
                <div class={`flex justify-center gap-0.5 ${review.starColor}`}>
                  {[...Array(5)].map(() => (
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      class="size-5"
                      viewBox="0 0 20 20"
                      fill="currentColor"
                    >
                      <path d={starPath} />
                    </svg>
                  ))}
                </div>

                <p class={`mt-2 text-xl font-semibold ${review.nameColor}`}>
                  {review.name}
                </p>
              </div>

              <p class="mt-4 text-center text-gray-200">{review.testimonial}</p>
            </blockquote>
          </div>
        ))
      }
    </div>

    <div class="mt-6 flex items-center justify-center gap-4">
      <button
        aria-label="Previous slide"
        id="keen-slider-previous"
        class="text-secondary hover:text-primary transition-colors"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke-width="1.5"
          stroke="currentColor"
          class="size-5"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M15.75 19.5L8.25 12l7.5-7.5"></path>
        </svg>
      </button>

      <p class="text-secondary w-16 text-center text-sm">
        <span id="keen-slider-active"></span>
        /
        <span id="keen-slider-count"></span>
      </p>

      <button
        aria-label="Next slide"
        id="keen-slider-next"
        class="text-secondary hover:text-primary transition-colors"
      >
        <svg
          class="size-5"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M9 5l7 7-7 7"
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"></path>
        </svg>
      </button>
    </div>
  </div>
</SectionContainer>
